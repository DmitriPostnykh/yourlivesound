<!-- fragments/form_1.html -->
<div th:fragment="form_1">
  <link rel="stylesheet" href="/css/form_1.css"> <!-- Styles for the form -->

  <style>
    /* Стили для полосы загрузки */
    .progress-container {
      width: 100%;
      background-color: #f3f3f3;
      margin-top: 10px;
    }

    .progress-bar {
      width: 0%;
      height: 20px;
      background-color: #4caf50;
      text-align: center;
      line-height: 20px;
      color: white;
    }
  </style>

  <div class="form-container">
    <h2>The website is under development, but you can contact us!</h2>
    <!-- Форма с использованием FormSubmit -->
    <form id="contactForm" method="POST" action="https://formsubmit.co/javadeveloper7377@gmail.com">
      <!-- Необходимо добавить скрытое поле для защиты от спама -->
      <input type="hidden" name="_captcha" value="false">
      <!-- Поле для URL страницы после отправки формы -->
      <input type="hidden" name="_next" value="/">

      <div class="form-group">
        <input type="text" id="name" name="name" placeholder="Name" required>
      </div>

      <div class="form-group">
        <input type="email" id="email" name="email" placeholder="Email" required>
      </div>

      <div class="form-group">
        <input type="tel" id="phone" name="phone" placeholder="Phone Number">
      </div>

      <div class="form-group">
        <textarea id="message" name="message" placeholder="Your Message" required></textarea>
      </div>

      <button type="submit" class="submit-button">Send</button>
    </form>
  </div>
  <div id="loadingMessage" style="display: none;">
    Отправляем, страница перезагрузится автоматически после отправки!<br>
    Прошло времени: <span id="elapsedTime">0</span> секунд
    <div class="progress-container">
      <div id="progressBar" class="progress-bar">0%</div>
    </div>
  </div>
  <script>
    document.getElementById('contactForm').addEventListener('submit', async function(event) {
      event.preventDefault(); // Останавливаем стандартную отправку формы
      document.getElementById('loadingMessage').style.display = 'block'; // Показать индикатор загрузки

      // Начало отсчета времени
      let startTime = Date.now();
      let elapsedTime = 0;
      const elapsedTimeElement = document.getElementById('elapsedTime');
      const progressBarElement = document.getElementById('progressBar');
      let progress = 0;

      // Функция обновления времени ожидания
      const updateElapsedTime = () => {
        elapsedTime = Math.floor((Date.now() - startTime) / 1000);
        elapsedTimeElement.textContent = elapsedTime;

        // Обновление полосы загрузки
        progress = Math.min(100, (elapsedTime / 5) * 100);
        progressBarElement.style.width = progress + '%';
        progressBarElement.textContent = Math.floor(progress) + '%';
      };

      // Запуск интервала для обновления времени ожидания каждую секунду
      const elapsedTimeInterval = setInterval(updateElapsedTime, 1000);

      try {
        const response = await fetch('https://formsubmit.co/ajax/javadeveloper7377@gmail.com', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            message: document.getElementById('message').value
          })
        });

        const data = await response.json();

        if (data.success) {
          window.location.href = '/'; // Немедленный редирект после успешной отправки
        } else {
          alert('There was an issue submitting the form.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
      } finally {
        clearInterval(elapsedTimeInterval); // Останавливаем интервал
        document.getElementById('loadingMessage').style.display = 'none'; // Скрыть индикатор загрузки
      }
    });
  </script>
</div>